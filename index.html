<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang tra cứu dữ liệu</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    h2 {
      margin-bottom: 10px;
    }
    input {
      width: 300px;
      padding: 8px;
      margin-bottom: 15px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>

<body>

<h2>Tra cứu dữ liệu</h2>

<input
  type="text"
  id="searchInput"
  placeholder="Nhập từ khóa để tra cứu..."
  onkeyup="filterTable()"
/>

<table id="dataTable"></table>

<script>
/* ===== LINK CSV GOOGLE SHEETS ===== */
/* File của bạn */
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/16AtA5daIKPlcjDUtnR20ndh6UhQlOdhx/export?format=csv&gid=111585543";

let originalData = [];

/* ===== TẢI DỮ LIỆU ===== */
fetch(CSV_URL)
  .then(response => response.text())
  .then(text => {
    const rows = text.trim().split("\n").map(r => r.split(","));
    const headers = rows.shift();

    originalData = rows.map(row => {
      let obj = {};
      headers.forEach((h, i) => {
        obj[h] = row[i] || "";
      });
      return obj;
    });

    renderTable(originalData);
  })
  .catch(() => {
    document.getElementById("dataTable").innerHTML =
      "<tr><td>Không tải được dữ liệu</td></tr>";
  });

/* ===== HIỂN THỊ BẢNG ===== */
function renderTable(data) {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";

  if (data.length === 0) {
    table.innerHTML = "<tr><td>Không có dữ liệu</td></tr>";
    return;
  }

  // Header
  const headerRow = document.createElement("tr");
  Object.keys(data[0]).forEach(key => {
    const th = document.createElement("th");
    th.textContent = key;
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  // Dữ liệu
  data.forEach(row => {
    const tr = document.createElement("tr");
    Object.values(row).forEach(value => {
      const td = document.createElement("td");
      td.textContent = value;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}

/* ===== TÌM KIẾM ===== */
function filterTable() {
  const keyword = document
    .getElementById("searchInput")
    .value
    .toLowerCase();

  const filtered = originalData.filter(row =>
    Object.values(row).some(value =>
      String(value).toLowerCase().includes(keyword)
    )
  );

  renderTable(filtered);
}
</script>

</body>
</html>
